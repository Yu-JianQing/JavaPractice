package SanShuJu_3;

import java.io.ByteArrayInputStream;
import java.io.IOException;
import java.io.InputStreamReader;
import java.util.Scanner;

public class VoteMsgTextCoder {
	public static final String Magic="Voting";
	public static final String Vote="v";
	public static final String InQuery="i";
	public static final String Response="R";
	
	public static final String CharSetFromat="ASC-II";
	public static final String Delimsir="  ";
	public static final int MaxLenth=2000;
	
	public byte [] toWrite(VoteMsg msg) throws IOException{
		String msgCode=Magic+Delimsir+
				(msg.isQuerry()?InQuery:Vote)+Delimsir+
				(msg.isResponse()?Response:"")+Delimsir+
				Integer.toString(msg.getCandidateID())+Delimsir+
				Long.toString(msg.getVoteCount());
		byte data[]=msgCode.getBytes(CharSetFromat);
		return data;
	}
	
	public VoteMsg fromWire(byte[] msg)throws IOException{
		ByteArrayInputStream msgStream=new ByteArrayInputStream(msg);
		Scanner sca=new Scanner(new InputStreamReader(msgStream,CharSetFromat));
		
		boolean isQuerry;
		boolean isResponse;
		int candidateID;
		long voteCount;
		
		String str;
		str=sca.next();
		if(!str.equals(Magic))
			throw new IOException("信息的第一个字符串不是"+Magic);
		
		str=sca.next();
		if(!str.equals(Vote)){
			isQuerry=false;
		}else if(!str.equals(InQuery)){
			throw new IOException("信息的第而个字符串不是"+InQuery);
		}else {
			isQuerry=true;
		}
		
		str=sca.next();
		if(str.equals(Response)){
			isResponse=true;
		}else {
			isResponse=false;
		}
		
		str=sca.next();
		candidateID=Integer.parseInt(str);
		
		if(isResponse){
			str=sca.next();
			voteCount=Long.parseLong(str);
		}else {
			voteCount=0;
		}
		
		return new VoteMsg(isQuerry, isResponse, candidateID, voteCount);
	}
}
